(function(t,e,i,s){"use strict";i="default"in i?i["default"]:i;s="default"in s?s["default"]:s;let r=10;let n=10;let a=e.vec3.new(0,0,-1);let h=e.vec3.new(1,0,0);let o=e.vec3.new(0,1,0);let c=e.quat.create();let _=e.quat.create();let u=e.quat.create();let d=e.mat3.create();let p=e.vec3.create();let l=e.vec3.create();let f=e.vec3.create();let m=e.vec3.create();let v=e.vec3.create();class w{constructor(t,i){i=i||{};i.theta=i.theta||0;i.phi=i.phi||0;i.eye=i.eye||e.vec3.new(0,0,0);i.near=i.near||.01;i.far=i.far||1e3;this._props=i;this._cache={view:new Float32Array(16),proj:new Float32Array(16)};this._input=t;this._view=e.mat4.create();this._proj=e.mat4.create();this._df=0;this._dr=0;this._panX=0;this._panY=0;this._panZ=0;this._curTheta=i.theta;this._curPhi=i.phi;this._curEye=e.vec3.clone(i.eye);this._theta=i.theta;this._phi=i.phi;this._eye=e.vec3.clone(i.eye)}tick(t,i,s){this._handleInput();this._calcView(t);this._calcProj(i,s);e.mat4.array(this._cache.view,this._view);e.mat4.array(this._cache.proj,this._proj)}_handleInput(){let t=this._input;this._df=0;this._dr=0;this._panX=0;this._panY=0;this._panZ=0;if(t.mousepress("left")&&t.mousepress("right")){let e=t.mouseDeltaX;let i=t.mouseDeltaY;this._panX=e;this._panY=-i}else if(t.mousepress("left")){let e=t.mouseDeltaX;let i=t.mouseDeltaY;this._theta-=e*.002;this._panZ=-i}else if(t.mousepress("right")){let e=t.mouseDeltaX;let i=t.mouseDeltaY;this._theta-=e*.002;this._phi-=i*.002}if(t.keypress("w")){this._df+=1}if(t.keypress("s")){this._df-=1}if(t.keypress("a")){this._dr-=1}if(t.keypress("d")){this._dr+=1}if(t.mouseScrollY){this._df-=t.mouseScrollY*.05}}_calcView(t){this._curPhi=e.lerp(this._curPhi,this._phi,t*r);this._curTheta=e.lerp(this._curTheta,this._theta,t*r);let i=this._eye;let s=this._curPhi;let w=this._curTheta;let y=this._panX;let g=this._panY;let A=this._panZ;e.quat.identity(_);e.quat.identity(u);e.quat.rotateX(_,_,s);e.quat.rotateY(u,u,w);e.quat.mul(c,u,_);e.mat3.fromQuat(d,c);e.vec3.transformMat3(p,a,d);e.vec3.transformMat3(f,o,d);e.vec3.transformMat3(l,h,d);if(this._df!==0){e.vec3.scaleAndAdd(i,i,p,this._df*t*n)}if(this._dr!==0){e.vec3.scaleAndAdd(i,i,l,this._dr*t*n)}if(A!==0){e.vec3.copy(m,p);m.y=0;e.vec3.normalize(m,m);e.vec3.scaleAndAdd(i,i,m,A*t*n)}if(y!==0){e.vec3.copy(v,l);v.y=0;e.vec3.normalize(v,v);e.vec3.scaleAndAdd(i,i,v,y*t*n)}if(g!==0){e.vec3.scaleAndAdd(i,i,o,g*t*n)}e.vec3.lerp(this._curEye,this._curEye,i,t*r);e.mat4.lookAt(this._view,this._curEye,e.vec3.scaleAndAdd(m,this._curEye,p,1),f)}_calcProj(t,i){e.mat4.perspective(this._proj,Math.PI/4,t/i,this._props.near,this._props.far)}}function y(t){return t({uniforms:{view:t.prop("view"),projection:t.prop("projection")}})}function g(t,i,s,r){let n=[];let a=e.mat4.array(new Float32Array(16),e.mat4.create());let h=i*.5;let o=s*.5;let c=i/r;let _=s/r;for(let t=-h;t<=h;t+=c){n.push(t,0,-o);n.push(t,0,o)}for(let t=-o;t<=o;t+=_){n.push(-h,0,t);n.push(h,0,t)}return t({blend:{enable:true,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]},vert:`
      precision mediump float;
      uniform mat4 model, view, projection;

      attribute vec3 a_pos;

      void main() {
        vec4 pos = projection * view * model * vec4(a_pos, 1);

        gl_Position = pos;
      }
    `,frag:`
      precision mediump float;

      void main () {
        gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
      }
    `,primitive:"lines",attributes:{a_pos:n},uniforms:{model:a},count:n.length/3})}function A(t){let i=t({vert:`
      precision mediump float;
      uniform mat4 model, view, projection;

      attribute vec3 a_pos;

      void main() {
        vec4 pos = projection * view * model * vec4(a_pos, 1);

        gl_Position = pos;
      }
    `,frag:`
      precision mediump float;
      uniform vec3 color;

      void main () {
        gl_FragColor = vec4(color, 1.0);
      }
    `,primitive:"lines",attributes:{a_pos:t.prop("line")},uniforms:{model:t.prop("transform"),color:t.prop("color")},count:2});const s=e.mat4.array(new Float32Array(16),e.mat4.create());const r=[[0,0,0],[1,0,0]];const n=[[0,0,0],[0,1,0]];const a=[[0,0,0],[0,0,1]];const h=[1,0,0];const o=[0,1,0];const c=[0,0,1];return function(t){t=t||s;i([{line:r,color:h,transform:t},{line:n,color:o,transform:t},{line:a,color:c,transform:t}])}}let E=e.mat4.create();let b=new Float32Array(16);class j{constructor(t){this._canvasEL=t;this._regl=i({canvas:t,extensions:["webgl_depth_texture","OES_texture_float","OES_texture_float_linear","OES_standard_derivatives"]});this._uniforms={};this._common=y(this._regl);this._drawGrid=g(this._regl,100,100,100);this._drawCoord=A(this._regl);this._nodes=[];this._nodesCnt=0}resize(){let t=this._canvasEL.parentElement.getBoundingClientRect();this._canvasEL.width=t.width;this._canvasEL.height=t.height}setUniform(t,e){this._uniforms[t]=e}drawNode(t){this._nodes[this._nodesCnt]=t;this._nodesCnt++}frame(t){this._regl.frame(i=>{this._reset();if(t){t(i)}this._regl.clear({color:[.3,.3,.3,1],depth:1});this._common(this._uniforms,()=>{for(let t=0;t<this._nodesCnt;++t){let i=this._nodes[t];i.getWorldMatrix(E);e.mat4.array(b,E);this._drawCoord(b)}this._drawGrid()})})}_reset(){this._nodesCnt=0}}class q{constructor(t){this._renderer=new j(t);this._input=new s(t,{lock:true});this._orbit=new w(this._input,{eye:e.vec3.new(0,5,10),phi:e.toRadian(-30)});this._last=0;this._dt=0;this._time=0;window.addEventListener("resize",()=>{this.resize()});window.requestAnimationFrame(()=>{this.resize()})}frame(t){this._renderer.frame(({time:time,viewportWidth:viewportWidth,viewportHeight:viewportHeight})=>{let e=time-this._last;this._last=time;this._dt=e;this._time=time;if(t){t()}this._orbit.tick(e,viewportWidth,viewportHeight);this._renderer.setUniform("view",this._orbit._cache.view);this._renderer.setUniform("projection",this._orbit._cache.proj);this._input.reset()})}resize(){this._renderer.resize();this._input.resize()}}t.Orbit=w;t.Renderer=j;t.Shell=q})(this.ddraw=this.ddraw||{},window.vmath,window.createREGL,window.Input);
//# sourceMappingURL=./dist/debug-draw.min.js.map