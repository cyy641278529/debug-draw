{"version":3,"file":"debug-draw.js","sources":["../lib/camera/orbit.js","../lib/command/common.js","../lib/command/grid.js","../lib/command/coord.js","../lib/command/line.js","../lib/renderer.js","../lib/shell.js"],"sourcesContent":["'use strict';\n\nimport { vec3, mat3, mat4, quat, lerp } from 'vmath';\n\nlet damping = 10.0;\nlet moveSpeed = 10.0;\n\nlet v3_f = vec3.new(0,0,-1);\nlet v3_r = vec3.new(1,0,0);\nlet v3_u = vec3.new(0,1,0);\n\nlet rotq = quat.create();\nlet rotx = quat.create();\nlet roty = quat.create();\nlet rot = mat3.create();\nlet front = vec3.create();\nlet right = vec3.create();\nlet up = vec3.create();\nlet front2 = vec3.create();\nlet right2 = vec3.create();\n\nexport default class Orbit {\n  constructor (input, props) {\n    props = props || {};\n    props.theta = props.theta || 0;\n    props.phi = props.phi || 0;\n    props.eye = props.eye || vec3.new(0,0,0);\n    props.near = props.near || 0.01;\n    props.far = props.far || 1000.0;\n    this._props = props;\n    this._cache = {\n      view: new Float32Array(16),\n      proj: new Float32Array(16),\n    };\n\n    this._input = input;\n    this._view = mat4.create();\n    this._proj = mat4.create();\n\n    this._df = 0;\n    this._dr = 0;\n    this._panX = 0;\n    this._panY = 0;\n    this._panZ = 0;\n    this._curTheta = props.theta;\n    this._curPhi = props.phi;\n    this._curEye = vec3.clone(props.eye);\n    this._theta = props.theta;\n    this._phi = props.phi;\n    this._eye = vec3.clone(props.eye);\n  }\n\n  tick (dt, viewportWidth, viewportHeight) {\n    this._handleInput();\n    this._calcView(dt);\n    this._calcProj(viewportWidth, viewportHeight);\n    mat4.array(this._cache.view, this._view);\n    mat4.array(this._cache.proj, this._proj);\n  }\n\n  _handleInput () {\n    let input = this._input;\n    this._df = 0;\n    this._dr = 0;\n    this._panX = 0;\n    this._panY = 0;\n    this._panZ = 0;\n\n    if ( input.mousepress('left') && input.mousepress('right') ) {\n      let dx = input.mouseDeltaX;\n      let dy = input.mouseDeltaY;\n\n      this._panX = dx;\n      this._panY = -dy;\n\n    } else if ( input.mousepress('left') ) {\n      let dx = input.mouseDeltaX;\n      let dy = input.mouseDeltaY;\n\n      this._theta -= dx * 0.002;\n      this._panZ = -dy;\n\n    } else if ( input.mousepress('right') ) {\n      let dx = input.mouseDeltaX;\n      let dy = input.mouseDeltaY;\n\n      this._theta -= dx * 0.002;\n      this._phi -= dy * 0.002;\n    }\n\n    if ( input.keypress('w') ) {\n      this._df += 1;\n    }\n    if ( input.keypress('s') ) {\n      this._df -= 1;\n    }\n    if ( input.keypress('a') ) {\n      this._dr -= 1;\n    }\n    if ( input.keypress('d') ) {\n      this._dr += 1;\n    }\n\n    if ( input.mouseScrollY ) {\n      this._df -= input.mouseScrollY * 0.05;\n    }\n  }\n\n  _calcView (dt) {\n    //\n    this._curPhi = lerp(this._curPhi, this._phi, dt * damping);\n    this._curTheta = lerp(this._curTheta, this._theta, dt * damping);\n\n    //\n    let eye = this._eye;\n    let phi = this._curPhi;\n    let theta = this._curTheta;\n\n    let panX = this._panX;\n    let panY = this._panY;\n    let panZ = this._panZ;\n\n    // phi == rot_x, theta == rot_y\n    quat.identity(rotx);\n    quat.identity(roty);\n\n    quat.rotateX(rotx, rotx, phi);\n    quat.rotateY(roty, roty, theta);\n    quat.mul(rotq, roty, rotx);\n    mat3.fromQuat(rot, rotq);\n\n    vec3.transformMat3(front, v3_f, rot);\n    vec3.transformMat3(up, v3_u, rot);\n    vec3.transformMat3(right, v3_r, rot);\n\n    if (this._df !== 0) {\n      vec3.scaleAndAdd(eye, eye, front, this._df * dt * moveSpeed);\n    }\n\n    if (this._dr !== 0) {\n      vec3.scaleAndAdd(eye, eye, right, this._dr * dt * moveSpeed);\n    }\n\n    if (panZ !== 0) {\n      vec3.copy(front2, front);\n      front2.y = 0.0;\n      vec3.normalize(front2, front2);\n      vec3.scaleAndAdd(eye, eye, front2, panZ * dt * moveSpeed);\n    }\n\n    if (panX !== 0) {\n      vec3.copy(right2, right);\n      right2.y = 0.0;\n      vec3.normalize(right2, right2);\n      vec3.scaleAndAdd(eye, eye, right2, panX * dt * moveSpeed);\n    }\n\n    if (panY !== 0) {\n      vec3.scaleAndAdd(eye, eye, v3_u, panY * dt * moveSpeed);\n    }\n\n    vec3.lerp(this._curEye, this._curEye, eye, dt * damping);\n\n    //\n    mat4.lookAt(this._view,\n      this._curEye,\n      vec3.scaleAndAdd(front2, this._curEye, front, 1.0),\n      up\n    );\n  }\n\n  _calcProj(w, h) {\n    mat4.perspective(this._proj,\n      Math.PI / 4.0,\n      w / h,\n      this._props.near,\n      this._props.far\n    );\n  }\n}","'use strict';\n\nexport default function common(regl) {\n  return regl({\n    uniforms: {\n      view: regl.prop('view'),\n      projection: regl.prop('projection')\n    }\n  });\n}","'use strict';\n\nimport { mat4 } from 'vmath';\n\nexport default function grid(regl, width, length, seg) {\n  let vertices = [];\n  let identity = mat4.array(new Float32Array(16), mat4.create());\n\n  let hw = width * 0.5;\n  let hl = length * 0.5;\n  let dw = width / seg;\n  let dl = length / seg;\n\n  for (let x = -hw; x <= hw; x += dw) {\n    vertices.push(x, 0, -hl);\n    vertices.push(x, 0, hl);\n  }\n\n  for (let z = -hl; z <= hl; z += dl) {\n    vertices.push(-hw, 0, z);\n    vertices.push(hw, 0, z);\n  }\n\n  return regl({\n    blend: {\n      enable: true,\n      func: {\n        srcRGB: 'src alpha',\n        srcAlpha: 1,\n        dstRGB: 'one minus src alpha',\n        dstAlpha: 1\n      },\n      equation: {\n        rgb: 'add',\n        alpha: 'add'\n      },\n      color: [0, 0, 0, 0]\n    },\n\n    vert: `\n      precision mediump float;\n      uniform mat4 model, view, projection;\n\n      attribute vec3 a_pos;\n\n      void main() {\n        vec4 pos = projection * view * model * vec4(a_pos, 1);\n\n        gl_Position = pos;\n      }\n    `,\n\n    frag: `\n      precision mediump float;\n\n      void main () {\n        gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n      }\n    `,\n\n    primitive: 'lines',\n\n    attributes: {\n      a_pos: vertices,\n    },\n\n    uniforms: {\n      model: identity,\n    },\n\n    count: vertices.length / 3\n  });\n}\n","import { mat4 } from 'vmath';\n\nexport default function coord (regl) {\n  let drawLines = regl({\n    vert: `\n      precision mediump float;\n      uniform mat4 model, view, projection;\n\n      attribute vec3 a_pos;\n      attribute vec3 a_color;\n\n      varying vec3 color;\n\n      void main() {\n        vec4 pos = projection * view * model * vec4(a_pos, 1);\n\n        gl_Position = pos;\n        color = a_color;\n      }\n    `,\n\n    frag: `\n      precision mediump float;\n      varying vec3 color;\n\n      void main () {\n        gl_FragColor = vec4(color, 1.0);\n      }\n    `,\n\n    primitive: 'lines',\n\n    attributes: {\n      a_pos: regl.prop('lines'),\n      a_color: regl.prop('colors'),\n    },\n\n    uniforms: {\n      model: regl.prop('transform'),\n    },\n\n    count: regl.prop('count'),\n  });\n\n  const identity = mat4.array(new Float32Array(16), mat4.create());\n\n  return function (transform) {\n    transform = transform || identity;\n    drawLines({\n      transform,\n      lines: [\n        [0, 0, 0], [0.5, 0, 0], // x\n        [0, 0, 0], [0, 0.5, 0], // y\n        [0, 0, 0], [0, 0, 0.5], // z\n      ],\n      colors: [\n        [1, 0, 0], [0.5, 0, 0], // x (red)\n        [0, 1, 0], [0, 0.5, 0], // y (blue)\n        [0, 0, 1], [0, 0, 0.5], // z (green)\n      ],\n      count: 6,\n    });\n  };\n}\n","export default function line (regl) {\n  return regl({\n    vert: `\n      precision mediump float;\n      uniform mat4 model, view, projection;\n\n      attribute vec3 a_pos;\n\n      void main() {\n        vec4 pos = projection * view * vec4(a_pos, 1);\n\n        gl_Position = pos;\n      }\n    `,\n\n    frag: `\n      precision mediump float;\n\n      void main () {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n    `,\n\n    primitive: 'lines',\n\n    attributes: {\n      a_pos: regl.prop('line'),\n    },\n\n    count: 2,\n  });\n}\n","import REGL from 'regl';\nimport {mat4} from 'vmath';\nimport common from './command/common';\nimport grid from './command/grid';\nimport coord from './command/coord';\nimport line from './command/line';\n\nlet m4_a = mat4.create();\nlet array_m4 = new Float32Array(16);\n\nexport default class Renderer {\n  constructor (canvasEL) {\n    this._canvasEL = canvasEL;\n    this._regl = REGL({\n      canvas: canvasEL,\n      extensions: [\n        'webgl_depth_texture',\n        'OES_texture_float',\n        'OES_texture_float_linear',\n        'OES_standard_derivatives'\n      ]\n    });\n    this._uniforms = {};\n\n    // init commands\n    this._common = common(this._regl);\n    this._drawGrid = grid(this._regl, 100, 100, 100);\n    this._drawCoord = coord(this._regl);\n    this._drawLine = line(this._regl);\n\n    //\n    this._nodes = [];\n    this._nodesCnt = 0;\n    this._destPosList = [];\n    this._destPosCnt = 0;\n\n    this._draws = [];\n    this._drawsCnt = 0;\n\n    this._drawsTransparent = [];\n    this._drawsTransparentCnt = 0;\n  }\n\n  resize() {\n    let bcr = this._canvasEL.parentElement.getBoundingClientRect();\n    this._canvasEL.width = bcr.width;\n    this._canvasEL.height = bcr.height;\n  }\n\n  setUniform(name, val) {\n    this._uniforms[name] = val;\n  }\n\n  drawNode(node) {\n    this._nodes[this._nodesCnt] = node;\n    this._nodesCnt++;\n  }\n\n  drawDestPos(pos) {\n    this._destPosList[this._destPosCnt] = pos;\n    this._destPosCnt++;\n  }\n\n  addCommand(cmd, data, transparent = false) {\n    if (transparent) {\n      this._drawsTransparent[this._drawsTransparentCnt] = { cmd, data };\n      this._drawsTransparentCnt++;\n    } else {\n      this._draws[this._drawsCnt] = { cmd, data };\n      this._drawsCnt++;\n    }\n  }\n\n  frame(cb) {\n    this._regl.frame(ctx => {\n      this._reset();\n\n      //\n      if (cb) {\n        cb(ctx);\n      }\n\n      // clear contents of the drawing buffer\n      this._regl.clear({\n        color: [0.3, 0.3, 0.3, 1],\n        depth: 1\n      });\n\n      // draw\n      this._common(this._uniforms, () => {\n        for (let i = 0; i < this._drawsCnt; ++i) {\n          let draw = this._draws[i];\n          draw.cmd(draw.data);\n        }\n\n        for (let i = 0; i < this._nodesCnt; ++i) {\n          let node = this._nodes[i];\n          node._getWorldRT(m4_a);\n          mat4.array(array_m4, m4_a);\n          this._drawCoord(array_m4);\n        }\n\n        for (let i = 0; i < this._destPosCnt; ++i) {\n          let pos = this._destPosList[i];\n          this._drawLine({\n            line: [[pos.x, pos.y, pos.z], [pos.x, pos.y + 1.0, pos.z]]\n          });\n        }\n\n        this._drawGrid();\n\n        for (let i = 0; i < this._drawsTransparentCnt; ++i) {\n          let draw = this._drawsTransparent[i];\n          draw.cmd(draw.data);\n        }\n\n      });\n    });\n  }\n\n  _reset() {\n    this._drawsCnt = 0;\n    this._drawsTransparentCnt = 0;\n    this._nodesCnt = 0;\n    this._destPosCnt = 0;\n  }\n}","import Input from 'input';\nimport {vec3, mat4, toRadian} from 'vmath';\nimport Orbit from './camera/orbit';\nimport Renderer from './renderer';\n\nexport default class Shell {\n  constructor ( canvasEL ) {\n    this._renderer = new Renderer(canvasEL);\n    this._input = new Input(canvasEL, {\n      lock: true\n    });\n    this._orbit = new Orbit(this._input, {\n      eye: vec3.new(0, 5, 10),\n      phi: toRadian(-30),\n    });\n    this._last = 0;\n    this._dt = 0;\n    this._time = 0;\n\n    this._invView = mat4.create();\n    this._invViewArray = new Float32Array(16);\n\n\n    // on window-resize\n    window.addEventListener('resize', () => {\n      this.resize();\n    });\n\n    window.requestAnimationFrame(() => {\n      this.resize();\n    });\n  }\n\n  frame (cb) {\n    this._renderer.frame(({time, viewportWidth, viewportHeight}) => {\n      let dt = time - this._last;\n\n      // smooth delta time\n      if (dt > 1) {\n        dt = 1;\n      }\n\n      this._last = time;\n      this._dt = dt;\n      this._time = time;\n\n      if (cb) {\n        cb();\n      }\n\n      this._orbit.tick(dt, viewportWidth, viewportHeight);\n      this._renderer.setUniform('view', this._orbit._cache.view);\n      this._renderer.setUniform('projection', this._orbit._cache.proj);\n\n\n      // inv-view\n      mat4.invert(this._invView, this._orbit._view);\n      mat4.array(this._invViewArray, this._invView);\n      this._renderer.setUniform('invView', this._invViewArray);\n\n      this._input.reset();\n    });\n  }\n\n  resize () {\n    this._renderer.resize();\n    this._input.resize();\n  }\n}"],"names":["vec3","quat","mat3","mat4","lerp","toRadian"],"mappings":";;;;;;;;;;;;;;;;;AAIA,IAAI,OAAO,GAAG,IAAI,CAAC;AACnB,IAAI,SAAS,GAAG,IAAI,CAAC;;AAErB,IAAI,IAAI,GAAGA,UAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5B,IAAI,IAAI,GAAGA,UAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3B,IAAI,IAAI,GAAGA,UAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;AAE3B,IAAI,IAAI,GAAGC,UAAI,CAAC,MAAM,EAAE,CAAC;AACzB,IAAI,IAAI,GAAGA,UAAI,CAAC,MAAM,EAAE,CAAC;AACzB,IAAI,IAAI,GAAGA,UAAI,CAAC,MAAM,EAAE,CAAC;AACzB,IAAI,GAAG,GAAGC,UAAI,CAAC,MAAM,EAAE,CAAC;AACxB,IAAI,KAAK,GAAGF,UAAI,CAAC,MAAM,EAAE,CAAC;AAC1B,IAAI,KAAK,GAAGA,UAAI,CAAC,MAAM,EAAE,CAAC;AAC1B,IAAI,EAAE,GAAGA,UAAI,CAAC,MAAM,EAAE,CAAC;AACvB,IAAI,MAAM,GAAGA,UAAI,CAAC,MAAM,EAAE,CAAC;AAC3B,IAAI,MAAM,GAAGA,UAAI,CAAC,MAAM,EAAE,CAAC;;AAE3B,AAAe,MAAM,KAAK,CAAC;EACzB,WAAW,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE;IACzB,KAAK,GAAG,KAAK,IAAI,EAAE,CAAC;IACpB,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,IAAI,CAAC,CAAC;IAC/B,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC;IAC3B,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,IAAIA,UAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACzC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,IAAI,IAAI,CAAC;IAChC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,IAAI,MAAM,CAAC;IAChC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACpB,IAAI,CAAC,MAAM,GAAG;MACZ,IAAI,EAAE,IAAI,YAAY,CAAC,EAAE,CAAC;MAC1B,IAAI,EAAE,IAAI,YAAY,CAAC,EAAE,CAAC;KAC3B,CAAC;;IAEF,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACpB,IAAI,CAAC,KAAK,GAAGG,UAAI,CAAC,MAAM,EAAE,CAAC;IAC3B,IAAI,CAAC,KAAK,GAAGA,UAAI,CAAC,MAAM,EAAE,CAAC;;IAE3B,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;IACb,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;IACb,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACf,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACf,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACf,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC;IAC7B,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,GAAG,CAAC;IACzB,IAAI,CAAC,OAAO,GAAGH,UAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IACrC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC;IAC1B,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC;IACtB,IAAI,CAAC,IAAI,GAAGA,UAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;GACnC;;EAED,IAAI,CAAC,CAAC,EAAE,EAAE,aAAa,EAAE,cAAc,EAAE;IACvC,IAAI,CAAC,YAAY,EAAE,CAAC;IACpB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;IACnB,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;IAC9CG,UAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;IACzCA,UAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;GAC1C;;EAED,YAAY,CAAC,GAAG;IACd,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC;IACxB,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;IACb,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;IACb,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACf,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACf,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;;IAEf,KAAK,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG;MAC3D,IAAI,EAAE,GAAG,KAAK,CAAC,WAAW,CAAC;MAC3B,IAAI,EAAE,GAAG,KAAK,CAAC,WAAW,CAAC;;MAE3B,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;MAChB,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC;;KAElB,MAAM,KAAK,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG;MACrC,IAAI,EAAE,GAAG,KAAK,CAAC,WAAW,CAAC;MAC3B,IAAI,EAAE,GAAG,KAAK,CAAC,WAAW,CAAC;;MAE3B,IAAI,CAAC,MAAM,IAAI,EAAE,GAAG,KAAK,CAAC;MAC1B,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC;;KAElB,MAAM,KAAK,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG;MACtC,IAAI,EAAE,GAAG,KAAK,CAAC,WAAW,CAAC;MAC3B,IAAI,EAAE,GAAG,KAAK,CAAC,WAAW,CAAC;;MAE3B,IAAI,CAAC,MAAM,IAAI,EAAE,GAAG,KAAK,CAAC;MAC1B,IAAI,CAAC,IAAI,IAAI,EAAE,GAAG,KAAK,CAAC;KACzB;;IAED,KAAK,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG;MACzB,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;KACf;IACD,KAAK,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG;MACzB,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;KACf;IACD,KAAK,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG;MACzB,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;KACf;IACD,KAAK,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG;MACzB,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;KACf;;IAED,KAAK,KAAK,CAAC,YAAY,GAAG;MACxB,IAAI,CAAC,GAAG,IAAI,KAAK,CAAC,YAAY,GAAG,IAAI,CAAC;KACvC;GACF;;EAED,SAAS,CAAC,CAAC,EAAE,EAAE;;IAEb,IAAI,CAAC,OAAO,GAAGC,UAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,EAAE,EAAE,GAAG,OAAO,CAAC,CAAC;IAC3D,IAAI,CAAC,SAAS,GAAGA,UAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,EAAE,EAAE,GAAG,OAAO,CAAC,CAAC;;;IAGjE,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC;IACpB,IAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC;IACvB,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC;;IAE3B,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;IACtB,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;IACtB,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;;;IAGtBH,UAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IACpBA,UAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;;IAEpBA,UAAI,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;IAC9BA,UAAI,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;IAChCA,UAAI,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IAC3BC,UAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;;IAEzBF,UAAI,CAAC,aAAa,CAAC,KAAK,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;IACrCA,UAAI,CAAC,aAAa,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;IAClCA,UAAI,CAAC,aAAa,CAAC,KAAK,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;;IAErC,IAAI,IAAI,CAAC,GAAG,KAAK,CAAC,EAAE;MAClBA,UAAI,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,GAAG,EAAE,GAAG,SAAS,CAAC,CAAC;KAC9D;;IAED,IAAI,IAAI,CAAC,GAAG,KAAK,CAAC,EAAE;MAClBA,UAAI,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,GAAG,EAAE,GAAG,SAAS,CAAC,CAAC;KAC9D;;IAED,IAAI,IAAI,KAAK,CAAC,EAAE;MACdA,UAAI,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;MACzB,MAAM,CAAC,CAAC,GAAG,GAAG,CAAC;MACfA,UAAI,CAAC,SAAS,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;MAC/BA,UAAI,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,GAAG,EAAE,GAAG,SAAS,CAAC,CAAC;KAC3D;;IAED,IAAI,IAAI,KAAK,CAAC,EAAE;MACdA,UAAI,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;MACzB,MAAM,CAAC,CAAC,GAAG,GAAG,CAAC;MACfA,UAAI,CAAC,SAAS,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;MAC/BA,UAAI,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,GAAG,EAAE,GAAG,SAAS,CAAC,CAAC;KAC3D;;IAED,IAAI,IAAI,KAAK,CAAC,EAAE;MACdA,UAAI,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,GAAG,EAAE,GAAG,SAAS,CAAC,CAAC;KACzD;;IAEDA,UAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,GAAG,EAAE,EAAE,GAAG,OAAO,CAAC,CAAC;;;IAGzDG,UAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK;MACpB,IAAI,CAAC,OAAO;MACZH,UAAI,CAAC,WAAW,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,GAAG,CAAC;MAClD,EAAE;KACH,CAAC;GACH;;EAED,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE;IACdG,UAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK;MACzB,IAAI,CAAC,EAAE,GAAG,GAAG;MACb,CAAC,GAAG,CAAC;MACL,IAAI,CAAC,MAAM,CAAC,IAAI;MAChB,IAAI,CAAC,MAAM,CAAC,GAAG;KAChB,CAAC;GACH;;;AChLY,SAAS,MAAM,CAAC,IAAI,EAAE;EACnC,OAAO,IAAI,CAAC;IACV,QAAQ,EAAE;MACR,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;MACvB,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC;KACpC;GACF,CAAC,CAAC;;;ACJU,SAAS,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE;EACrD,IAAI,QAAQ,GAAG,EAAE,CAAC;EAClB,IAAI,QAAQ,GAAGA,UAAI,CAAC,KAAK,CAAC,IAAI,YAAY,CAAC,EAAE,CAAC,EAAEA,UAAI,CAAC,MAAM,EAAE,CAAC,CAAC;;EAE/D,IAAI,EAAE,GAAG,KAAK,GAAG,GAAG,CAAC;EACrB,IAAI,EAAE,GAAG,MAAM,GAAG,GAAG,CAAC;EACtB,IAAI,EAAE,GAAG,KAAK,GAAG,GAAG,CAAC;EACrB,IAAI,EAAE,GAAG,MAAM,GAAG,GAAG,CAAC;;EAEtB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE;IAClC,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IACzB,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;GACzB;;EAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE;IAClC,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACzB,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;GACzB;;EAED,OAAO,IAAI,CAAC;IACV,KAAK,EAAE;MACL,MAAM,EAAE,IAAI;MACZ,IAAI,EAAE;QACJ,MAAM,EAAE,WAAW;QACnB,QAAQ,EAAE,CAAC;QACX,MAAM,EAAE,qBAAqB;QAC7B,QAAQ,EAAE,CAAC;OACZ;MACD,QAAQ,EAAE;QACR,GAAG,EAAE,KAAK;QACV,KAAK,EAAE,KAAK;OACb;MACD,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;KACpB;;IAED,IAAI,EAAE,CAAC;;;;;;;;;;;IAWP,CAAC;;IAED,IAAI,EAAE,CAAC;;;;;;IAMP,CAAC;;IAED,SAAS,EAAE,OAAO;;IAElB,UAAU,EAAE;MACV,KAAK,EAAE,QAAQ;KAChB;;IAED,QAAQ,EAAE;MACR,KAAK,EAAE,QAAQ;KAChB;;IAED,KAAK,EAAE,QAAQ,CAAC,MAAM,GAAG,CAAC;GAC3B,CAAC,CAAC;CACJ;;ACtEc,SAAS,KAAK,EAAE,IAAI,EAAE;EACnC,IAAI,SAAS,GAAG,IAAI,CAAC;IACnB,IAAI,EAAE,CAAC;;;;;;;;;;;;;;;IAeP,CAAC;;IAED,IAAI,EAAE,CAAC;;;;;;;IAOP,CAAC;;IAED,SAAS,EAAE,OAAO;;IAElB,UAAU,EAAE;MACV,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC;MACzB,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;KAC7B;;IAED,QAAQ,EAAE;MACR,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC;KAC9B;;IAED,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC;GAC1B,CAAC,CAAC;;EAEH,MAAM,QAAQ,GAAGA,UAAI,CAAC,KAAK,CAAC,IAAI,YAAY,CAAC,EAAE,CAAC,EAAEA,UAAI,CAAC,MAAM,EAAE,CAAC,CAAC;;EAEjE,OAAO,UAAU,SAAS,EAAE;IAC1B,SAAS,GAAG,SAAS,IAAI,QAAQ,CAAC;IAClC,SAAS,CAAC;MACR,SAAS;MACT,KAAK,EAAE;QACL,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;QACtB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QACtB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC;OACvB;MACD,MAAM,EAAE;QACN,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;QACtB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QACtB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC;OACvB;MACD,KAAK,EAAE,CAAC;KACT,CAAC,CAAC;GACJ,CAAC;CACH;;AC/Dc,SAAS,IAAI,EAAE,IAAI,EAAE;EAClC,OAAO,IAAI,CAAC;IACV,IAAI,EAAE,CAAC;;;;;;;;;;;IAWP,CAAC;;IAED,IAAI,EAAE,CAAC;;;;;;IAMP,CAAC;;IAED,SAAS,EAAE,OAAO;;IAElB,UAAU,EAAE;MACV,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;KACzB;;IAED,KAAK,EAAE,CAAC;GACT,CAAC,CAAC;CACJ;;ACxBD,IAAI,IAAI,GAAGA,UAAI,CAAC,MAAM,EAAE,CAAC;AACzB,IAAI,QAAQ,GAAG,IAAI,YAAY,CAAC,EAAE,CAAC,CAAC;;AAEpC,AAAe,MAAM,QAAQ,CAAC;EAC5B,WAAW,CAAC,CAAC,QAAQ,EAAE;IACrB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;IAC1B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;MAChB,MAAM,EAAE,QAAQ;MAChB,UAAU,EAAE;QACV,qBAAqB;QACrB,mBAAmB;QACnB,0BAA0B;QAC1B,0BAA0B;OAC3B;KACF,CAAC,CAAC;IACH,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;;;IAGpB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAClC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IACjD,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACpC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;;IAGlC,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;IACjB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;IACnB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;IACvB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;;IAErB,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;IACjB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;;IAEnB,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;IAC5B,IAAI,CAAC,oBAAoB,GAAG,CAAC,CAAC;GAC/B;;EAED,MAAM,GAAG;IACP,IAAI,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,qBAAqB,EAAE,CAAC;IAC/D,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;IACjC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;GACpC;;EAED,UAAU,CAAC,IAAI,EAAE,GAAG,EAAE;IACpB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC;GAC5B;;EAED,QAAQ,CAAC,IAAI,EAAE;IACb,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC;IACnC,IAAI,CAAC,SAAS,EAAE,CAAC;GAClB;;EAED,WAAW,CAAC,GAAG,EAAE;IACf,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,GAAG,CAAC;IAC1C,IAAI,CAAC,WAAW,EAAE,CAAC;GACpB;;EAED,UAAU,CAAC,GAAG,EAAE,IAAI,EAAE,WAAW,GAAG,KAAK,EAAE;IACzC,IAAI,WAAW,EAAE;MACf,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,oBAAoB,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC;MAClE,IAAI,CAAC,oBAAoB,EAAE,CAAC;KAC7B,MAAM;MACL,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC;MAC5C,IAAI,CAAC,SAAS,EAAE,CAAC;KAClB;GACF;;EAED,KAAK,CAAC,EAAE,EAAE;IACR,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,IAAI;MACtB,IAAI,CAAC,MAAM,EAAE,CAAC;;;MAGd,IAAI,EAAE,EAAE;QACN,EAAE,CAAC,GAAG,CAAC,CAAC;OACT;;;MAGD,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC;QACf,KAAK,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;QACzB,KAAK,EAAE,CAAC;OACT,CAAC,CAAC;;;MAGH,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM;QACjC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE;UACvC,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;UAC1B,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACrB;;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE;UACvC,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;UAC1B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;UACvBA,UAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;UAC3B,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;SAC3B;;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC,EAAE;UACzC,IAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;UAC/B,IAAI,CAAC,SAAS,CAAC;YACb,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;WAC3D,CAAC,CAAC;SACJ;;QAED,IAAI,CAAC,SAAS,EAAE,CAAC;;QAEjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,oBAAoB,EAAE,EAAE,CAAC,EAAE;UAClD,IAAI,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;UACrC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACrB;;OAEF,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ;;EAED,MAAM,GAAG;IACP,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;IACnB,IAAI,CAAC,oBAAoB,GAAG,CAAC,CAAC;IAC9B,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;IACnB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;GACtB;;;ACxHY,MAAM,KAAK,CAAC;EACzB,WAAW,CAAC,EAAE,QAAQ,GAAG;IACvB,IAAI,CAAC,SAAS,GAAG,IAAI,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACxC,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,QAAQ,EAAE;MAChC,IAAI,EAAE,IAAI;KACX,CAAC,CAAC;IACH,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE;MACnC,GAAG,EAAEH,UAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;MACvB,GAAG,EAAEK,cAAQ,CAAC,CAAC,EAAE,CAAC;KACnB,CAAC,CAAC;IACH,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACf,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;IACb,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;;IAEf,IAAI,CAAC,QAAQ,GAAGF,UAAI,CAAC,MAAM,EAAE,CAAC;IAC9B,IAAI,CAAC,aAAa,GAAG,IAAI,YAAY,CAAC,EAAE,CAAC,CAAC;;;;IAI1C,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,MAAM;MACtC,IAAI,CAAC,MAAM,EAAE,CAAC;KACf,CAAC,CAAC;;IAEH,MAAM,CAAC,qBAAqB,CAAC,MAAM;MACjC,IAAI,CAAC,MAAM,EAAE,CAAC;KACf,CAAC,CAAC;GACJ;;EAED,KAAK,CAAC,CAAC,EAAE,EAAE;IACT,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE,aAAa,EAAE,cAAc,CAAC,KAAK;MAC9D,IAAI,EAAE,GAAG,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;;;MAG3B,IAAI,EAAE,GAAG,CAAC,EAAE;QACV,EAAE,GAAG,CAAC,CAAC;OACR;;MAED,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;MAClB,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;MACd,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;;MAElB,IAAI,EAAE,EAAE;QACN,EAAE,EAAE,CAAC;OACN;;MAED,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,aAAa,EAAE,cAAc,CAAC,CAAC;MACpD,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;MAC3D,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,YAAY,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;;;;MAIjEA,UAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;MAC9CA,UAAI,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;MAC9C,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;;MAEzD,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;KACrB,CAAC,CAAC;GACJ;;EAED,MAAM,CAAC,GAAG;IACR,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;IACxB,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;GACtB;,;;;;"}